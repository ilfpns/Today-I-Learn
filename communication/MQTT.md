> **Message Queueing Telemetry Transport**
> 

---

⇒ 국제 표준화된 발행-구독 기반의 메시지 송수신 프로토콜이다

### 사용처

- 작은 코드 공간이 필요할 때
- 네트워크 대역폭이 제한되는 원격 통신이 필요할 때
- IoT와 같은 제한된, 혹은 대규모 트래픽 전송을 위해 만들어진 프로토콜이다

⇒ TCP/IP 프로토콜 위에서 동작하지만, 동시에 굉장히 가벼우며, 많은 통신 제약들을 해결해준다

### 특징

- 연결지향적
    
    → MQTT 브로커와 연결을 요청하는 클라이언트는 연결 후 명시적 연결 종료나 네트워크 사정에 의해 연결이 끊어질 때 까지 상태를 유지
    
    → Live 라는 하트비트와 Topic 에 발행되는 메시지를 통해 연결을 유지하고 메시지 송수신을 하게됨
    
    → 연결이 끊어지면 재접속 가능
    
- 브로커를 통한 통신
    
    → MQTT의 발행-구독 메시징 패턴은 오로지 브로커를 통해서만 통신할 수 있다
    
    → 개석된 Topic 메시지를 발행하면 해당 Topic을 구독하는 클라이언트들에게 메시지를 발행할 수 있다
    
    → 일대일 혹은 일대다 통신이 모두 가능하다
    
- Quality Of Service
    1. QoS 0 : 최대 1회 전송, Topic 을 통해 메시지를 전송할 뿐 보장은 하지 않는다
    2. QoS 1 : 최소 1회 저송, 구독하는 클라이언트가 메시지를 받았는지 불확실하면 정해진 횟수만큼 재전송 
    3. QoS 2 : 구독하는 클라이언트가 요구된 메시지를 정확히 한 번 수신할 수 있도록 보장한다, 가장 안전한 메시지를 보낼 때 쓴다
    4. MQTT 송신자와 수신자 간에만 사용된다
    5. 메시지는 글자 수 제한이 없다
    6. 0에 가까울수록 메시지 처리에 대한 부하가 줄어들고, 메시지 손실의 위험이 높아진다, 반대로 2에 가까울수록 메시지 손식 위험이 줄어들지만 처리 부하가 급격히 높아진다

### 메시지 유형

- 연결하기
    
    → 서버와의 연결 수립을 기다린 다음 노드 간 링크를 만든다
    
- 연결끊기
    
    → MQTT 클라이언트가 해야 할 일을 기다리고 인터넷 프로토콜 스위트 세션의 연결이 끊어지기를 기다린다
    
- 발행하기
    
    → MQTT 클라이언트에 요청이 전달된 직후 어플리케이션 스레드에 즉시 반환한다
    

### MQTT 동작 구조

<img width="947" height="380" alt="image" src="https://github.com/user-attachments/assets/a494dec5-6e2b-496a-9e75-06fbedef5154" />

**토픽 (Topic)**

- 메시지를 발행-구독하는 행위는 채널 단위로 일어난다
- 이를 MQTT에서는 토픽이라 부르고, 이는 (/)로 구분된다

1. 클라이언트가 Topic에 메시지 발행
2. 해당 Topic을 구독하는 클라이언트가 메시지를 수신
3. 클라이언트는 여러 Topic을 구독할 수 있고, 모든 클라이언트가 발행/구독을 할 수 있다

### Quality Of Service

- QoS 0
    
    ⇒ 발행자가 브로커에 메시지 보내고 끝
    
    ⇒ 브로커가 받았는지 확인 없음
    
    ⇒ 네트워크 문제 있으면 메시지 유실 가능
    
    예제 : 온도 센서 : 초당 10회 측정값 발행
    
    → 한두 번 빠져도 상관 없음 (속도가 중요함)
    
- QoS 1
    
    ⇒ 발행자가 보낸 후, 브로커가 PUBACK (확인 응답)을 줌 
    
    ⇒ 발행자는 ACK를 못 받으면 다시 전송
    
    ⇒ 수신자가 중복 메시지를 받을 수 있음
    
    예제 : 알람 시스템 : 화재 센서가 연기 감지 
    
    → 유실되면  안 되니, 중복되더라도 최소 한 번은 반드시 전달
    

- QoS 2
    
    ⇒ 가장 무겁고 복잡한 절차 
    
    ⇒ 발행자와 브로커가 4단계 핸드셰이크로 메시지 중복/유식 방지
    
    ⇒ 수신자는 딱 한 번만 메시지 받음 
    
    예제 : 금융 거래 시스템 : 중요한 메시지
    
    → 중복/유실 둘 다 치명적이므로 반드시 정확히 1회만 전달
